event = "OS",
variables = c("Age")
)
summary(g2)
plot(g2)#Age==65
data$MRscore<-ifelse(data$MRscore>=median(data$MRscore),"High_MRscore","Low_MRscore")
data$Age<-ifelse(data$Age>=65,"High_age","Low_age")
coxfit<-coxph(Surv(OStime,OS) ~ MRscore+Stage+Age+Gender,data = data)
p<-forest_model(coxfit,factor_separate_line=F,
format_options = list(colour= "black",
shape = 12,
text_size = 4,
banded = T),
theme = theme_forest())
p
library(survival)
library(survminer)
library(reshape2)
library(data.table)
library(stringr)
library(reshape2)
library(dplyr)
library(plyr)
library(survivalROC)
library(forestplot)
p<-forest_model(coxfit,factor_separate_line=F,
format_options = list(colour= "black",
shape = 12,
text_size = 4,
banded = T),
theme = theme_forest())
library(forestmodel)
p<-forest_model(coxfit,factor_separate_line=F,
format_options = list(colour= "black",
shape = 12,
text_size = 4,
banded = T),
theme = theme_forest())
p
covariates<-list("MRscore","Stage","Age","Gender")
univ_formulas<-list()
for (i in seq_len(length(covariates))) {
univ_formulas[[i]] <- sapply(covariates[[i]],
function(x){
##print(x)
as.formula(paste('Surv(OStime, OS)~', x))
})
}
levels(factor(data$MRscore))
#cox indifferent stage
cox<- coxph(Surv(OStime, OS)~MRscore, data = subset(data,Stage=="How_stage"))
levels(factor(data$Stage))
head(data)
#cox indifferent stage
cox<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="High_stage"))
#cox indifferent stage
cox<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="High_stage"))
mutil_res<-summary(cox)
mutil_res
mutil_res_table<-as.data.frame(cbind(mutil_res$coefficients,mutil_res$conf.int[,-c(1,2)]))
#cox indifferent stage
cox<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
mutil_res<-summary(cox)
mutil_res_table<-as.data.frame(cbind(mutil_res$coefficients,mutil_res$conf.int[,-c(1,2)]))
summary(cox)
summary(cox_early)
#cox indifferent stage
cox_early<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
summary(cox_early)
summary(cox_late)
colnames(data)
#cox indifferent stage
cox_early_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_early_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_early_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(data,Stage=="Low_stage"))
summary(cox_early_OS)
summary(cox_late_OS)
summary(cox_early_PFI)
summary(cox_late_PFI)
summary(cox_early_DSS)
summary(cox_late_DSS)
cox_res<-cox_early_OS
res_table<-as.data.frame(cbind(cox_res$coefficients,cox_res$conf.int[,-c(1,2)]))
res_table
cox_res$coefficients
cox_res<-summary(cox_early_OS)
res_table<-as.data.frame(cbind(cox_res$coefficients,cox_res$conf.int[,-c(1,2)]))
View(res_table)
cox_res$conf.int
cox_res$coefficients
res_table<-as.data.frame(bind_cols(cox_res$coefficients,cox_res$conf.int[,-c(1,2)]))
View(res_table)
cox_res<-list()
cox_res$early_OS<-summary(cox_early_OS)
cox_res$early_OS<-summary(cox_early_OS)
cox_res$early_PFI<-summary(cox_early_PFI)
cox_res$late_PFI<-summary(cox_late_PFI)
cox_res$late_OS<-summary(cox_late_OS)
cox_res$early_DSS<-summary(cox_early_DSS)
cox_res$late_DSS<-summary(cox_late_DSS)
res_table<-subset(res_table,`Pr(>|z|)`<=0.05)
View(res_table)
res_table<-as.data.frame(cbind(cox_res$coefficients,cox_res$conf.int[,-c(1,2)]))
for(i in c(1:6)){
res_table[[i]]<-as.data.frame(cbind(cox_res[[i]]$coefficients,
cox_res[[i]]$conf.int[,-c(1,2)]))
}
res_table[[1]]
res_table[[2]]
cox_res$early_OS<-summary(cox_early_OS)
cox_res$late_OS<-summary(cox_late_OS)
cox_res$early_PFI<-summary(cox_early_PFI)
cox_res$late_PFI<-summary(cox_late_PFI)
cox_res$early_DSS<-summary(cox_early_DSS)
cox_res$late_DSS<-summary(cox_late_DSS)
cox_res$early_OS$concordance
cox_res$early_OS$coefficients
cox_res$late_DSS$concordance
cox_res$late_DSS
cox_res$early_OS$coefficients
cox_res$late_DSS$concordance
res_table<-
res_table<-bind_cols(list(cox_res$early_OS$coefficients
,cox_res$early_OS$conf.int[,-c(1,2)]
,cox_res$late_DSS$concordance))
data.frame(cox_res$early_OS$coefficients)
res_table<-bind_cols(list(data.frame(cox_res$early_OS$coefficients)
)
)))
res_table<-
res_table<-bind_cols(list(data.frame(cox_res$early_OS$coefficients)
,data.frame(cox_res$early_OS$conf.int[,-c(1,2)])
,data.frame(cox_res$late_DSS$concordance)))
res_table<-
res_table<-cbind(data.frame(cox_res$early_OS$coefficients)
,data.frame(cox_res$early_OS$conf.int[,-c(1,2)])
,data.frame(cox_res$late_DSS$concordance))
res_table<-
res_table<-cbind((cox_res$early_OS$coefficients)
,cox_res$early_OS$conf.int[,-c(1,2)]
,cox_res$late_DSS$concordance)
View(res_table)
res_table<-cox_res$early_OS$coefficients%>%append(cox_res$early_OS$concordance)
View(res_single)
res_table
res_table<-table(cox_res$early_OS$coefficients)%>%
append(cox_res$early_OS$concordance)%>%
append(cox_res$early_OS$conf.int)
res_table
res_table<-table(cox_res$early_OS$coefficients)%>%
with(cox_res$early_OS$concordance)%>%
append(cox_res$early_OS$conf.int)
res_table<-as.data.frame(cox_res$early_OS$coefficients)%>%
append(cox_res$early_OS$concordance)%>%
append(cox_res$early_OS$conf.int)
View(res_table)
res_table
cox_res$early_OS<-summary(cox_early_OS)$coefficients
cox_res$late_OS<-summary(cox_late_OS)$coefficients
cox_res$early_PFI<-summary(cox_early_PFI)$coefficients
cox_res$late_PFI<-summary(cox_late_PFI)$coefficients
cox_res$early_DSS<-summary(cox_early_DSS)$coefficients
cox_res$late_DSS<-summary(cox_late_DSS)$coefficients
cox_res$early_OS<-summary(cox_early_OS)$coefficients%>%mutate(Group=early_OS)
cox_res$late_OS<-summary(cox_late_OS)$coefficients%>%mutate(Group=early_OS)
cox_res$early_PFI<-summary(cox_early_PFI)$coefficients%>%mutate(Group=early_PFI)
cox_res$early_OS<-summary(cox_early_OS)$coefficients%>%mutate(Group="early_OS")
cox_res$early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")
cox_res$early_OS
cox_res$early_OS<-summary(cox_early_OS)$coefficients%>%
data.frame()%>%mutate(Group="early_OS")
cox_res$early_OS
summary(cox_early_OS)$coefficients
cox_res$early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame(row.names = rownames(.))%>%mutate(Group="early_OS")
cox_res$early_OS
rownames(summary(cox_early_OS)$coefficients)
cox_res$early_OS<-as.data.frame(summary(cox_early_OS)$coefficients)%>%mutate(Group="early_OS")
cox_res$early_OS
cox_res$early_OS<-as.data.frame(row.names = rownames(summary(cox_early_OS)$coefficients),summary(cox_early_OS)$coefficients)%>%mutate(Group="early_OS")
cox_res$early_OS
coef_early_OS<-summary(cox_early_OS)$coefficients%>%mutate(Variables=rownames(.))%>%
as.data.frame()%>%mutate(Group="early_OS")
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%mutate(Variables=rownames(.))
View(coef_early_OS)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%mutate(Variables=rownames(.))
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%mutate(Variables=rownames(summary(cox_early_OS)))
View(coef_early_OS)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%mutate(Variables=rownames(summary(cox_early_OS)))
View(coef_early_OS)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)))
coef_early_OS
rownames(summary(cox_early_OS))
summary(cox_early_OS
)
find_number<-function(number,excel_from,excel_to){
fromNum<-colnames(excel_from)[grep(number,colnames(excel_from))]
toNum<-colnames(excel_to)[grep(number,colnames(excel_to))]
}
excel_from<-data.frame(a=sample(c(1:1000),100),a=sample(c(100:500),100))
excel_from
excel_B<-data.frame(a=sample(c(1:1000),100),a=sample(c(100:500),100))
excel_A<-data.frame(a=sample(c(2:100),50),a=sample(c(100:300),50))
find_number<-function(number,excel_A,excel_B){
from_Num<-colnames(excel_from)[grep(number,colnames(excel_from))]
to_Num<-colnames(excel_to)[grep(number,colnames(excel_to))]
return(list(from_Num,to_Num))
}
find_number<-function(number,excel_A,excel_B){
from_Num<-colnames(excel_from)[grep(number,colnames(excel_A))]
to_Num<-colnames(excel_to)[grep(number,colnames(excel_B))]
message(paste0(number,"in",from_Num,"row","of excel_A"))
message(paste0(number,"in",to_Num,"row","of excel_B"))
return(list(from_Num,to_Num))
}
excel_B<-data.frame(col_a1=sample(c(1:1000),100),col_b1=sample(c(100:500),100))
excel_A<-data.frame(col_a2=sample(c(2:100),50),col_b2=sample(c(100:300),50))
find_number<-function(number,
excel_A,excel_B,
names_col_A,names_col_B){
from_Num<-excel_A[,names_col_A][grep(number,excel_A[,names_col_A])]
to_Num<-excel_B[,names_col_B][grep(number,excel_B[,names_col_B])]
message(paste0(number,"in",from_Num,"row","of excel_A"))
message(paste0(number,"in",to_Num,"row","of excel_B"))
return(list(from_Num,to_Num))
}
excel_B
find_number<-function(number,
excel_A,excel_B,
names_col_A,names_col_B){
from_Num<-excel_A[,names_col_A][grep(number,excel_A[,names_col_A])]
to_Num<-excel_B[,names_col_B][grep(number,excel_B[,names_col_B])]
message(paste0(number,"in",from_Num,"row","of excel_A"))
message(paste0(number,"in",to_Num,"row","of excel_B"))
return(list(from_Num,to_Num))
}
find_number(number = "25",excel_A ,excel_B,names_col_A = col_a1,excel_B =col_a2 )
find_number(number = "25",excel_A ,excel_B,names_col_A = "col_a1",names_col_B = "col_a2")
find_number(number = "25",excel_A ,excel_B,
names_col_A = "col_a2",
names_col_B = "col_a1")
excel_B<-data.frame(col_a2=sample(c(1:1000),100),col_b2=sample(c(100:500),100))
excel_A<-data.frame(col_a1=sample(c(2:100),50),col_b1=sample(c(100:300),50))
find_number<-function(number,
excel_A,excel_B,
names_col_A,names_col_B){
from_Num<-excel_A[,names_col_A][grep(number,excel_A[,names_col_A])]
to_Num<-excel_B[,names_col_B][grep(number,excel_B[,names_col_B])]
message(paste0(number," in ",from_Num," ",names_col_A," of excel_A"))
message(paste0(number,"in",to_Num," ", names_col_B," of excel_B"))
}
find_number(number = "25",
excel_A ,excel_B,
names_col_A = "col_a1",
names_col_B = "col_a2")
find_number<-function(number,
excel_A,excel_B,
names_col_A,names_col_B){
from_Num<-excel_A[,names_col_A][grep(number,excel_A[,names_col_A])]
to_Num<-excel_B[,names_col_B][grep(number,excel_B[,names_col_B])]
message(paste0(number," is in ",from_Num," ",names_col_A," of excel_A"))
message(paste0(number," is in",to_Num," ", names_col_B," of excel_B"))
}
find_number(number = "25",
excel_A ,excel_B,
names_col_A = "col_a1",
names_col_B = "col_a2")
\
find_number(number = "25",
excel_A ,excel_B,
names_col_A = "col_a1",
names_col_B = "col_a2")
find_number(number = "25",
excel_A ,excel_B,
names_col_A = "col_a1",
names_col_B = "col_a2")
names(summary(cox_early_OS)$coefficients)
names(summary(cox_early_OS))
rownames(summary(cox_early_OS)$coefficients)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%mutate(test=rownames(.))%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)))
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))
coef_early_OS
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))
coef_late_OS<-summary(cox_late_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_OS")%>%
mutate(Variables=rownames(summary(cox_late_OS)$coefficients))
coef_early_PFI<-summary(cox_early_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="early_PFI")%>%
mutate(Variables=rownames(summary(cox_eearly_PFI)$coefficients))
coef_late_PFI<-summary(cox_late_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="late_PFI")%>%
mutate(Variables=rownames(summary(cox_late_PFI)$coefficients))
coef_early_DSS<-summary(cox_early_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_DSS")%>%
mutate(Variables=rownames(summary(cox_early_DSS)$coefficients))
coef_early_PFI<-summary(cox_early_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="early_PFI")%>%
mutate(Variables=rownames(summary(cox_early_PFI)$coefficients))
coef_late_PFI<-summary(cox_late_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="late_PFI")%>%
mutate(Variables=rownames(summary(cox_late_PFI)$coefficients))
coef_early_DSS<-summary(cox_early_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_DSS")%>%
mutate(Variables=rownames(summary(cox_early_DSS)$coefficients))
coef_late_DSS<-summary(cox_late_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_DSS")%>%
mutate(Variables=rownames(summary(cox_late_DSS)$coefficients))
coef_late_OS
coef=bind_cols(list(coef_early_OS,coef_late_OS,
coef_early_PFI, coef_late_PFI,
coef_early_DSS, coef_late_DSS))
View(coef)
coef=bind_rows(list(coef_early_OS,coef_late_OS,
coef_early_PFI, coef_late_PFI,
coef_early_DSS, coef_late_DSS))
coef
summary(cox_early_OS)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%bind_cols(summary(cox_early_OS)$Concordance)
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))%>%
bind_cols(summary(cox_early_OS)$Concordance)
coef_early_OS
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))%>%
cbind(.,summary(cox_early_OS)$Concordance)
#cox indifferent stage
cox_early_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="High_stage"))
cox_late_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(data,Stage=="High_stage"))
cox_early_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_early_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(data,Stage=="Low_stage"))
cox_late_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(data,Stage=="High_stage"))
cox_res<-list()
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))%>%
cbind(.,summary(cox_early_OS)$Concordance)
coef_late_OS<-summary(cox_late_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_OS")%>%
mutate(Variables=rownames(summary(cox_late_OS)$coefficients))
coef_early_PFI<-summary(cox_early_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="early_PFI")%>%
mutate(Variables=rownames(summary(cox_early_PFI)$coefficients))
coef_late_PFI<-summary(cox_late_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="late_PFI")%>%
mutate(Variables=rownames(summary(cox_late_PFI)$coefficients))
coef_early_DSS<-summary(cox_early_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_DSS")%>%
mutate(Variables=rownames(summary(cox_early_DSS)$coefficients))
coef_late_DSS<-summary(cox_late_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_DSS")%>%
mutate(Variables=rownames(summary(cox_late_DSS)$coefficients))
coef=bind_rows(list(coef_early_OS,coef_late_OS,
coef_early_PFI, coef_late_PFI,
coef_early_DSS, coef_late_DSS))
res_table<-as.data.frame(cox_res$early_OS$coefficients)%>%
append(cox_res$early_OS$concordance)%>%
append(cox_res$early_OS$conf.int)
View(coef)
#cox indifferent stage
cox_early_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(meta,Stage=="Low_stage"))
meta$MRscore[1:3]
View(coef)
View(meta)
summary(cox_early_OS)
#cox indifferent stage
cox_early_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(meta,Stage=="Low_stage"))
cox_late_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(data,Stage=="High_stage"))
cox_early_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(meta,Stage=="Low_stage"))
cox_late_PFI<- coxph(Surv(PFItime, PFI)~MRscore,
data = subset(meta,Stage=="High_stage"))
cox_early_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(meta,Stage=="Low_stage"))
cox_late_DSS<- coxph(Surv(DSStime, DSS)~MRscore,
data = subset(meta,Stage=="High_stage"))
cox_res<-list()
coef_early_OS<-summary(cox_early_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))%>%
cbind(.,summary(cox_early_OS)$Concordance)
coef_late_OS<-summary(cox_late_OS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_OS")%>%
mutate(Variables=rownames(summary(cox_late_OS)$coefficients))
coef_early_PFI<-summary(cox_early_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="early_PFI")%>%
mutate(Variables=rownames(summary(cox_early_PFI)$coefficients))
coef_late_PFI<-summary(cox_late_PFI)$coefficients%>%
as.data.frame()%>%mutate(Group="late_PFI")%>%
mutate(Variables=rownames(summary(cox_late_PFI)$coefficients))
coef_early_DSS<-summary(cox_early_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_DSS")%>%
mutate(Variables=rownames(summary(cox_early_DSS)$coefficients))
coef_late_DSS<-summary(cox_late_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="late_DSS")%>%
mutate(Variables=rownames(summary(cox_late_DSS)$coefficients))
coef=bind_rows(list(coef_early_OS,coef_late_OS,
coef_early_PFI, coef_late_PFI,
coef_early_DSS, coef_late_DSS))
View(clinic7706)
summary(cox_early_OS)
Cindex_early_OS<-summary(cox_early_OS)$Concordance%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
mutate(Variables=rownames(summary(cox_early_OS)$Concordance))%>%
cbind(.,summary(cox_early_OS)$Concordance)
Cindex_early_OS
Cindex_early_OS<-summary(cox_early_OS)$Concordance%>%
as.data.frame()%>%mutate(Group="early_OS")%>%
cbind(.,summary(cox_early_OS)$Concordance)
Cindex_early_OS
summary(cox_early_OS)$Concordance
summary(cox_early_OS)
summary(cox_early_OS)
Cindex_early_OS<-cox_early_OS$concordance%>%
cbind(.,summary(cox_early_OS)$Concordance)
Cindex_early_OS
test=summary(cox_early_OS)
test$concordance
summary(cox_early_OS)$concordance
Cindex_early_OS<-summary(cox_early_OS)$concordance%>%
cbind(.,summary(cox_early_OS)$Concordance)
Cindex_early_OS
rownames(summary(cox_early_OS)$Concordance)
coef_early_DSS<-summary(cox_early_DSS)$coefficients%>%
as.data.frame()%>%mutate(Group="early_DSS")%>%
mutate(Variables=rownames(summary(cox_early_DSS)$coefficients))
coef_early_DSS
Cindex_early_OS<-summary(cox_early_OS)$concordance%>%
mutate(Variables=rownames(summary(cox_early_OS)$Concordance))
Cindex_early_OS<-summary(cox_early_OS)$concordance%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))
Cindex_early_OS<-summary(cox_early_OS)$concordance%>%
as.data.frame()%>%
mutate(Variables=rownames(summary(cox_early_OS)$coefficients))
Cindex_early_OS
riskScore=predict(coef_early_OS,type="risk",newdata=meta)
#cox indifferent stage
cox_early_OS<- coxph(Surv(OStime, OS)~MRscore,
data = subset(meta,Stage=="Low_stage"))
riskScore=predict(cox_early_OS,type="risk",newdata=meta)
risk=as.vector(ifelse(riskScore>1,"high","low"))
COX_risk_result<-cbind(id=rownames(cbind(meta[,8:9],riskScore,risk)),
cbind(data[,8:9],riskScore,risk))
data = subset(meta,Stage=="Low_stage")
data = subset(meta,Stage=="Low_stage")
riskScore=predict(cox_early_OS,type="risk",newdata=data)
risk=as.vector(ifelse(riskScore>1,"high","low"))
COX_risk_result<-cbind(id=rownames(cbind(data[,8:9],riskScore,risk)),
cbind(data[,8:9],riskScore,risk))
write.csv(COX_risk_result,"../dataset/TCGA_cox/MRscore_COX_riskinEarlystage.csv")
rt=read.csv("../dataset/TCGA_cox/MRscore_COX_riskinEarlystage.csv",check.names=F,row.names=1)
roc=survivalROC(Stime=rt$OStime, status=rt$OS, marker = rt$riskScore,
predict.time =3, method="KM")
pdf(file=paste0("../dataset/TCGA_cox/MRscore_COX_riskROC_early.pdf"))
par(oma=c(0.5,1,0,1),font.lab=1.5,font.axis=1.5)
plot(roc$FP, roc$TP, type="l", xlim=c(0,1), ylim=c(0,1),col='red',
xlab="False positive rate", ylab="True positive rate",
main=paste("ROC curve (", "AUC = ",round(roc$AUC,3),")"),
lwd = 2, cex.main=1.3, cex.lab=1.2, cex.axis=1.2, font=1.2)
abline(0,1)
plot(roc$FP, roc$TP, type="l", xlim=c(0,1), ylim=c(0,1),col='red',
xlab="False positive rate", ylab="True positive rate",
main=paste("ROC curve (", "AUC = ",round(roc$AUC,3),")"),
lwd = 2, cex.main=1.3, cex.lab=1.2, cex.axis=1.2, font=1.2)
abline(0,1)
fit<- survfit(Surv(OStime/30, OS) ~ risk, data = rt)
diff=survdiff(Surv(OStime/30, OS) ~risk,data = rt)
pValue=1-pchisq(diff$chisq,df=1)
pValue=round(pValue,14)
plot(fit, lty = 2:3,col=c("red","blue"),xlab="time (months)",
ylab="survival rate",
main=paste("survival curve (p=", pValue ,")",sep=""),mark.time=T)
legend("topright", c("Low risk", "High risk"), lty = 2:3, col=c("blue","red"))
